<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Analysing the real-time position public transport data in Turin | Fabio Mazza</title> <meta name="author" content="Fabio Mazza"> <meta name="description" content="Personal website of Fabio Mazza "> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%97%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://fabmazz.github.io/blog/2024/torino-bus/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Fabio </span>Mazza</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Analysing the real-time position public transport data in Turin</h1> <p class="post-meta">February 10, 2024</p> <p class="post-tags"> <a href="/blog/2024"> <i class="fas fa-calendar fa-sm"></i> 2024 </a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>I have recently begun analysing a dataset of real-time positions of the vehicles of the GTT public transport operator in Turin, Italy. The dataset contained information of the position of each vehicle at a particular time, and the line and the number of the vehicle along a trip identifier.</p> <p>The positions have been collected over the first two weeks of December 2023, and the total amount is about 21 million, from all public transport lines. You can see how many positions are collected at each minute in the figure below:</p> <figure> <a href="/assets/img/positions/counts_pos.png" target="_blank"> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/positions/counts_pos-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/positions/counts_pos-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/positions/counts_pos-1400.webp"></source> <img src="/assets/img/positions/counts_pos.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Count of positions updates" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </a> </figure> <p>It’s curious to note that on the weekend the number of positions collected is markedly lower (the 3rd of December was a Sunday, and the 8th December is a national holiday in Italy).</p> <p>Because of the very high number of positions, and of my ever-present interest in new programming languages, I decided to use <a href="https://www.julialang.org" target="blank" rel="external nofollow noopener">Julia</a> for this analysis, as it is very intuitive and fast.</p> <h2 id="cleaning-up-the-data">Cleaning up the data</h2> <p>The dataset had to be removed of all spurious data points which could not be possibly explained. In fact, there are several points that were very far from Italy, or from Turin in general. Some trams GPS, were, for example, continuously jumping from Turin to Genoa for no apparent reason: this made for an average speed of more than 1000 km/h!</p> <figure> <a href="/assets/img/positions/jumping_line.jpg" target="_blank"> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/positions/jumping_line-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/positions/jumping_line-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/positions/jumping_line-1400.webp"></source> <img src="/assets/img/positions/jumping_line.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Vehicle jumping around" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </a> </figure> <div class="caption"> A trace of a vehicle jumping continuously from Turin to another city </div> <p>Therefore, I set to remove all positions with a distance from the center of Turin higher than 17.5 km. I also decided to discard any data points without a trip identifier, for reasons which will become clearer later.</p> <p>Then, I separated the data by line, vehicle number and trip id, thus creating a trace of each vehicle on each trip. After cutting each trace when it jumped more than 500 m and by more than a minute and half, I had a series of traces for the trips, and I proceeded to analyse each line individually.</p> <h2 id="line-analysis">Line analysis</h2> <p>At this point, I had another problem: sometimes the data of the trace is not cut when the vehicle leaves service and goes to the depot. This is very evident in line 10, for example, whose trams make all the way from the center to the north depot of Venaria at night time.</p> <p>Therefore, I used the track information of each line, which is a polyline showing the general path of a line, and the list of stops the line makes. Initially, I split the polyLine into regular sections of 500 m: this was done by dividing the polyline in many small segments, then finding the one which passed the threshold each time. Obviously, there is not a perfect correspondance between the points where each section begins and the positions recorded for a vehicle. Thus, I inserted a new position in the vehicle trace for each section: since the trace is actually a collection of segments, in geometrical terms, it’s only necessary to split the segment at a new point closest to the section point. For the time of the new “recorded” position, working under the assumption of simple linear motion, I put the mean averaged by the distance between the two ends of the segment.</p> <p>Below you can see an example on the map, with the line trajectory or polyline in grey, the section points in light blue, and the trace in blu with each of its point highlighted. The red crosses represent the new point that are inserted in the vehicle trace:</p> <div class="mt-0 mt-md-0 mx-auto float-end" style="max-width:350px"> <figure> <a href="/assets/img/positions/line_section.jpg" target="_blank"> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/positions/line_section-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/positions/line_section-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/positions/line_section-1400.webp"></source> <img src="/assets/img/positions/line_section.jpg" class="float-end img-fluid rounded z-depth-1" width="auto" height="auto" title="Line sections and trace" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </a> </figure> </div> <p>The polyline was also useful to the determine when the bus was leaving service and going to the depot: by keeping the vehicle positions within a small threshold of the polyline points (about 30 meters), the trace of the vehicle was well defined. The division is section made it possible to also distinguish when the vehicle was actually running in the direction opposite to that of the trip (from south to north in the previous example).</p> <p>After this part was done, I was able to compute the average per section on each trip. This was done by computing the total distance travelled by each vehicle in each section, and the time spent in each section, and then diving them. What I’ve obtained now is a new coarse-grained dataset, for which there are also timestamps of each section/trip/vehicle tuple.</p> <p>From this new dataset, I’ve obtained a few different results, averaging the speed on either just the section or the hour of the day. The two figures below show the average speed on the map, and for each section at each day.</p> <div class="mt-0 mt-md-0 mx-auto float-end" style="max-width:500px"> <figure> <a href="/assets/img/positions/avg_speed_map_09_1.jpg" target="_blank"> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/positions/avg_speed_map_09_1-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/positions/avg_speed_map_09_1-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/positions/avg_speed_map_09_1-1400.webp"></source> <img src="/assets/img/positions/avg_speed_map_09_1.jpg" class="float-end img-fluid rounded z-depth-1" width="auto" height="auto" title="Average speed for section" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </a> </figure> </div> <div class="mt-0 mt-md-0 mx-auto float-end"> <figure> <a href="/assets/img/positions/avg_speed_matr_09_1.jpg" target="_blank"> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/positions/avg_speed_matr_09_1-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/positions/avg_speed_matr_09_1-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/positions/avg_speed_matr_09_1-1400.webp"></source> <img src="/assets/img/positions/avg_speed_matr_09_1.jpg" class="float-end img-fluid rounded z-depth-1" width="auto" height="auto" title="Average speed for section" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </a> </figure> </div> <p>From these two figures, it can be seen that the speed varies a lot depending on the part of the trajectory, and it’s unclear on which factors it depends. Since the 9 is a tramway line, it might be possible that the high speed of section 19 is due to the state of the tracks there (it’s completely separated by other traffic). However, the presence of close stops might also explain the low speed of other sections.</p> <h2 id="future-outlooks">Future outlooks</h2> <p>So far, I’ve only done this analysis on line 9, and I think it’s really cool to see the real (although, averaged) speed of a public transport line. I think that the ability to look at different times during the day is also important, and one interesting question that remains to be answered is whether the physical separation is helpful in keeping an higher average speed in the public transport. The answer should be “yes, of course”, but I’d be quite cool to see it from the data.</p> <p>Moreover, it would be interesting to see if there is a difference in average speed between the hours of high peak traffic, and the hours of low traffic. These questions could be answered also by extending the analysis into several weeks of data.</p> <p>P.S. I’ve published the code for the analysis on Github, available <a href="https://github.com/fabmazz/PositionsParsing" target="_blank" rel="external nofollow noopener">here</a>.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/gtfs-isochrones/">Making isochrones with OpenStreetMap data and GTFS</a> </li> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Fabio Mazza. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>.. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>